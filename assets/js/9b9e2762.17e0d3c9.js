"use strict";(self.webpackChunk_autometa_documentation=self.webpackChunk_autometa_documentation||[]).push([[1460],{4993:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(2983);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||s;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:r,o[1]=i;for(var u=2;u<s;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7527:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var a=n(3050),r=(n(2983),n(4993));const s={sidebar_position:10},o="Assertions Reference",i={unversionedId:"reference/assertions",id:"reference/assertions",title:"Assertions Reference",description:"The ensure function provides a fluent API for assertions. It is designed to be readable, extensible, and context-aware.",source:"@site/docs/reference/assertions.md",sourceDirName:"reference",slug:"/reference/assertions",permalink:"/autometa/docs/v1.0.0-rc.0/reference/assertions",draft:!1,editUrl:"https://github.com/Bendat/autometa/tree/main/documentation/website/docs/reference/assertions.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10},sidebar:"reference",previous:{title:"DTO Builder Deep Dive",permalink:"/autometa/docs/v1.0.0-rc.0/reference/dto-builder"}},l={},u=[{value:"Core Assertions",id:"core-assertions",level:2},{value:"Equality",id:"equality",level:3},{value:"Truthiness",id:"truthiness",level:3},{value:"Types",id:"types",level:3},{value:"Collections",id:"collections",level:3},{value:"HTTP Assertions",id:"http-assertions",level:2},{value:"Negation",id:"negation",level:2},{value:"Plugin Negation",id:"plugin-negation",level:3},{value:"Custom Messages (Labels)",id:"custom-messages-labels",level:2},{value:"Turning Checks Into Rules",id:"turning-checks-into-rules",level:2},{value:"Deep Dive: How <code>ensure</code> Works",id:"deep-dive-how-ensure-works",level:2},{value:"1. Standard Assertion: <code>ensure(value)</code>",id:"1-standard-assertion-ensurevalue",level:3},{value:"2. Plugin Access: <code>ensure(world)</code>",id:"2-plugin-access-ensureworld",level:3},{value:"Why the &quot;Intermediate Property&quot;?",id:"why-the-intermediate-property",level:3},{value:"Context Awareness",id:"context-awareness",level:3},{value:"Extending <code>ensure</code>",id:"extending-ensure",level:2}],p={toc:u},c="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"assertions-reference"},"Assertions Reference"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure")," function provides a fluent API for assertions. It is designed to be readable, extensible, and context-aware."),(0,r.kt)("h2",{id:"core-assertions"},"Core Assertions"),(0,r.kt)("h3",{id:"equality"},"Equality"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(value).toBe(expected);\nensure(value).toEqual(expected); // Deep equality\nensure(value).toStrictEqual(expected); // Strict deep equality\n")),(0,r.kt)("h3",{id:"truthiness"},"Truthiness"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(value).toBeTruthy();\nensure(value).toBeFalsy();\nensure(value).toBeDefined();\nensure(value).toBeUndefined();\nensure(value).toBeNull();\n")),(0,r.kt)("h3",{id:"types"},"Types"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(value).toBeInstanceOf(MyClass);\n")),(0,r.kt)("h3",{id:"collections"},"Collections"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(array).toHaveLength(3);\nensure(array).toContainEqual(item);\nensure(array).toBeArrayContaining([1, 2]);\nensure(object).toBeObjectContaining({ id: 1 });\n")),(0,r.kt)("h2",{id:"http-assertions"},"HTTP Assertions"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"@autometa/assertions")," keeps the base ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure(value)")," chain domain-agnostic. For HTTP assertions, use ",(0,r.kt)("inlineCode",{parentName:"p"},"@autometa/http"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'import { ensureHttp } from "@autometa/http";\n\nensureHttp(response).toHaveStatus(200);\nensureHttp(response).toHaveStatus("2xx");\nensureHttp(response).toHaveHeader("content-type", /json/);\nensureHttp(response).toBeCacheable();\nensureHttp(response).toHaveCorrelationId();\n')),(0,r.kt)("h2",{id:"negation"},"Negation"),(0,r.kt)("p",null,"All standard assertions can be negated using the ",(0,r.kt)("inlineCode",{parentName:"p"},".not")," property."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(value).not.toBe(expected);\nensure(array).not.toHaveLength(0);\n")),(0,r.kt)("h3",{id:"plugin-negation"},"Plugin Negation"),(0,r.kt)("p",null,"Plugins also support negation via ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure.not.<facet>"),". Under the hood, plugin facets are instantiated with:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"context.isNot")," set to ",(0,r.kt)("inlineCode",{parentName:"li"},"true")),(0,r.kt)("li",{parentName:"ul"},"an ",(0,r.kt)("inlineCode",{parentName:"li"},"ensure(...)")," function that behaves like ",(0,r.kt)("inlineCode",{parentName:"li"},"ensure(value).not..."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// ensure.not.custom.isAwesome()\n// Inside the plugin, ensure(value).toBe(...) becomes ensure(value).not.toBe(...)\nensure.not.custom.isAwesome();\n\n// With an HTTP facet (e.g. from @autometa/http\'s httpAssertionsPlugin)\nensure.not.http(response).toHaveStatus(500);\n\n// Chain-level negation still works too:\nensure.http(response).not.toHaveHeader("content-type", "text/plain");\n')),(0,r.kt)("admonition",{title:"Requirement",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"For plugin negation to work automatically, your plugin must use the ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure")," function passed in the context for all its assertions. If you perform manual checks (e.g., throwing errors directly), they will not be negated.")),(0,r.kt)("h2",{id:"custom-messages-labels"},"Custom Messages (Labels)"),(0,r.kt)("p",null,"You can provide a custom label to make error messages more descriptive. This is particularly useful when asserting against dynamic values or properties."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'ensure(value, { label: "User ID" }).toBe(123);\n// Error: Expected User ID to be 123, but got 456\n')),(0,r.kt)("h2",{id:"turning-checks-into-rules"},"Turning Checks Into Rules"),(0,r.kt)("p",null,"Assertion plugins work best when they express domain rules instead of low-level plumbing:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},'// If you expose an HTTP chain as a facet:\nensure.response.toHaveStatus("2xx").toHaveCorrelationId();\nensure.not.response.toHaveStatus("5xx");\n')),(0,r.kt)("p",null,"You can also use ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure(...).toBeDefined().value")," to avoid noisy casts when extracting required values."),(0,r.kt)("h2",{id:"deep-dive-how-ensure-works"},"Deep Dive: How ",(0,r.kt)("inlineCode",{parentName:"h2"},"ensure")," Works"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure")," function you import from your step definitions is actually a ",(0,r.kt)("strong",{parentName:"p"},"Facade")," created by the ",(0,r.kt)("inlineCode",{parentName:"p"},"CucumberRunner"),". It behaves differently depending on how you call it."),(0,r.kt)("h3",{id:"1-standard-assertion-ensurevalue"},"1. Standard Assertion: ",(0,r.kt)("inlineCode",{parentName:"h3"},"ensure(value)")),(0,r.kt)("p",null,"When called with a value, it returns an ",(0,r.kt)("inlineCode",{parentName:"p"},"EnsureChain"),". This is the standard assertion object with methods like ",(0,r.kt)("inlineCode",{parentName:"p"},".toBe()"),", ",(0,r.kt)("inlineCode",{parentName:"p"},".toEqual()"),", etc."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(1).toBe(1);\n")),(0,r.kt)("h3",{id:"2-plugin-access-ensureworld"},"2. Plugin Access: ",(0,r.kt)("inlineCode",{parentName:"h3"},"ensure(world)")),(0,r.kt)("p",null,"When called with the ",(0,r.kt)("inlineCode",{parentName:"p"},"World")," object, it returns the ",(0,r.kt)("strong",{parentName:"p"},"Facade")," itself, but with your registered plugins attached as properties."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"// Assuming you registered a plugin with the key 'custom'\nensure(world).custom.isAwesome();\n")),(0,r.kt)("p",null,"This works because ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure")," is a Proxy. When it detects that the argument is the ",(0,r.kt)("inlineCode",{parentName:"p"},"World")," object, it delegates to the plugin factory associated with that world."),(0,r.kt)("p",null,"When you\u2019re inside a step handler or hook, the runner supplies the current world implicitly, so ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure.custom.*")," works without passing ",(0,r.kt)("inlineCode",{parentName:"p"},"world")," around."),(0,r.kt)("h3",{id:"why-the-intermediate-property"},'Why the "Intermediate Property"?'),(0,r.kt)("p",null,"You might notice that accessing plugins requires an intermediate property (the plugin key), like ",(0,r.kt)("inlineCode",{parentName:"p"},".custom")," in the example above."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"ensure(world).custom.isAwesome();\n")),(0,r.kt)("p",null,"This design choice prevents naming collisions. Since plugins can define any method names they want, merging them all directly onto ",(0,r.kt)("inlineCode",{parentName:"p"},"ensure(world)")," could lead to conflicts (e.g., two plugins defining ",(0,r.kt)("inlineCode",{parentName:"p"},"hasStatus"),"). By namespacing plugins under their registration keys, you get a clean, conflict-free API."),(0,r.kt)("h3",{id:"context-awareness"},"Context Awareness"),(0,r.kt)("p",null,'Plugins are "World-Aware". When you call ',(0,r.kt)("inlineCode",{parentName:"p"},"ensure(world)"),", the plugins are instantiated with that specific world instance. This allows them to access shared state, such as the last HTTP response or database connection."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const myPlugin = ({ ensure }) => (world) => ({\n  hasStatus(status) {\n    // Access world.lastResponse here\n    ensure(world.lastResponse.status).toBe(status);\n  }\n});\n")),(0,r.kt)("h2",{id:"extending-ensure"},"Extending ",(0,r.kt)("inlineCode",{parentName:"h2"},"ensure")),(0,r.kt)("p",null,"See the ",(0,r.kt)("a",{parentName:"p",href:"/autometa/docs/v1.0.0-rc.0/getting-started/assertion-plugins"},"Assertion Plugins")," guide for details on how to add your own domain-specific assertions."))}d.isMDXComponent=!0}}]);